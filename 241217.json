[{"bookSourceComment": "基于 PyFQWeb 项目开发的 Legado 兼容书源\n/*\n搜索模式默认是搜书\n需要漫画则在关键字前加m:即m:系统\n听书则为t:系统\n*/", "bookSourceGroup": "番茄小说", "bookSourceName": "番茄小说", "bookSourceType": 0, "bookSourceUrl": "http://fqweb.shutiao.cloudns.ch", "bookUrlPattern": "/detail?book_id=.+", "customOrder": -92799, "enabled": true, "enabledCookieJar": false, "enabledExplore": true, "exploreUrl": "@js:\n\n个人中心 = 1\n\njs = (cid, genre, gender) => `@js:\nsource.bookSourceUrl + \"/reading/bookapi/new_category/landing/v/?\" + [\n    \"category_id=${cid}\",\n    \"limit=20\",\n    \"offset=\" + (page - 1),\n    \"gender=${gender}\",\n    \"genre=${genre}\"\n  ].join(\"&\")`\n\nobj = (title, url, type) => ({\n  title: title,\n  url: url,\n  style: {\n    layout_flexGrow: 1,\n    layout_flexBasisPercent: type\n  }\n})\n\narr = []\njava.longToast(\"请稍等，发现列表正在热更新！\")\nindex=[0, 1, 2]\nfor (let i of index) {\n  // java.toast(i)\n  let type = i\n  $ = JSON.parse(java.ajax(source.bookSourceUrl + \"/reading/bookapi/new_category/front/v/?\" + [\n      \"update_version_code=58932\",\n      \"distinct_style=1\",\n      \"new_category_tab=\" + i\n    ].join(\"&\")\n  )).data.category_tab_data\n  cate = []\n  cate.push(obj(\n    \"====== \" + $.tab_name + \" ======\", \"\", 1\n  ))\n  $.cell_data.forEach((c) => {\n    gender_1 = (type == 0 || type == 1) ? type : 1;\n    genre_1 = type == 3 ? 1 : type == 5 ? 110 : type == 6 ? 130 : 0;\n    cate.push(obj(\n      c.cell_name,\n      js(c.atom_data[0].category_data.category_id, genre_1, gender_1),\n      1\n    ))\n    for (j = 2; j < 5; j++) {\n      c.atom_data.slice(1).forEach((a) => {\n        d = a.category_data\n        if (d.name.length == j) {\n          cate.push(obj(d.name, js(d.category_id, genre_1, gender_1), -1))\n        }\n      })\n    }\n  })\n  arr = cate.concat(arr)\n}\n\nlet book_shelf_url = 'https://fanqienovel.com/reading/bookapi/bookshelf/info/v:version/?aid=1967&iid=0&version_code=57700&update_version_code=57700' \nlet book_shelf_info = JSON.parse(java.ajax(book_shelf_url + ', ' + JSON.stringify({\n  headers: {\n    'Cookie': \"sessionid=\" + (String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) ? String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) : (source.getLoginInfoMap() ? source.getLoginInfoMap() : {})['手动登录Token']),\n  }\n})))\n\njava.log(JSON.stringify(book_shelf_info))\n\nlet username\nif (book_shelf_info.code != 0) {\n  个人中心 = 0\n} else {\n  let uinfo = java.ajax(\"https://fanqienovel.com/api/user/info/v2,\" + JSON.stringify({ headers: { Cookie: \"sessionid=\" + (String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) ? String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) : (source.getLoginInfoMap() ? source.getLoginInfoMap() : {})['手动登录Token']) }}))\n  uinfo = JSON.parse(uinfo)\n  username = uinfo.data.name\n}\n\nlet gro = []\npush = (title, url, type) => gro.push({\n  title: title,\n  url: url,\n  style: {\n    layout_flexGrow: 1,\n    layout_flexBasisPercent: type\n  }\n});\n\nlet sArr = []\n\nif (个人中心) {\n  let groups_bookids = {\n    \"未分组\": []\n  }\n  book_shelf_info.data.book_shelf_info.forEach(i => {\n    if (!groups_bookids[i.group_name ? i.group_name : \"未分组\"]) groups_bookids[i.group_name] = []\n    groups_bookids[i.group_name ? i.group_name : \"未分组\"].push(i.book_id)\n  })\n\n  Object.keys(groups_bookids).forEach(k => {\n    var multi_detail_post_body = {\n      data: {\n        book_shelf_info: []\n      }\n    }\n    groups_bookids[k].forEach(i => multi_detail_post_body.data.book_shelf_info.push({ book_id: String(i), item_id: '0' }))\n    // var multi_detail_group_url = `https://fanqienovel.com/api/bookshelf/multidetail,${JSON.stringify(multi_detail_post_body)}` \n    // var book_ids = getBookId(JSON.stringify(multi_detail_post_body)).join(\",\") \n    push(k, \"https://fanqienovel.com/fqbookshelf/groupName/\" + k, 0.4)\n  })\n  if (Object.keys(groups_bookids).length % 2 != 0) push(\"占位\", \"\", 0.4)\n  // java.log(JSON.stringify(gro, null, 2))\n  sArr.push(obj(username + '的个人中心', '', 1))\n  // sArr.push(obj('首页推荐', \"https://fanqienovel.com/tab/0\", 0.4))\n  // sArr.push(obj('猜你喜欢', \"https://fanqienovel.com/tab/1\", 0.4))\n  // sArr.push(obj('猜你喜欢', \"https://fanqienovel.com/tab/1\", 0.4))\n  sArr.push(obj(\"我的书架\", \"https://fanqienovel.com/fqbookshelf\", 1))\n  \n  sArr = sArr.concat(gro)\n  // java.toast(JSON.stringify(sArr)) \n  sArr.push(obj(\"阅读历史\",\"https://fanqienovel.com/reading/bookapi/read_history/list/v/?aid=1967&app_name=novelapp&channel=0&iid=1&offset={{(page-1)*100}}&os_version=12&version_code=59732,\" + JSON.stringify({ headers: { Cookie: \"sessionid=\" + (String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) ? String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) : (source.getLoginInfoMap() ? source.getLoginInfoMap() : {})['手动登录Token']) }}), 1))\n}\n\narr = sArr.concat(arr)\nJSON.stringify(arr)\n", "header": "", "jsLib": "let replaceCover = (u) => {\n    if (u.startsWith(\"https://\")) u = u.substring(8)\n    else u = u.substring(7)\n    let uArr = u.split(\"/\")\n    uArr[0] = \"https://p6-novel.byteimg.com/origin\"\n    let uArr2 = []\n    uArr.forEach((x) => {\n        if (!x.includes(\"?\") && !x.includes(\"~\")) uArr2.push(x)\n        else uArr2.push(x.split(\"~\")[0])\n    })\n    u = uArr2.join(\"/\")\n    return u\n}\n\nfunction splitArray(input, size) {\n  const output = []\n  for (let i = 0; i < input.length; i += size) {\n    output.push(input.slice(i, i + size))\n  }\n  return output\n}\n\nfunction getNovelComment(book_id, type) {\n    const { java, source, book } = this\n    if (type == 0) {\n    let count = book.getVariable(\"custom\")\n    if (count && count == \"\") count = 5\n    let res = java.ajax(`https://changdunovel.com/reading/ugc/novel_comment/book/v1?query_type=0&offset=0&count=${count}&sort=create_time&need_hot_comment=0&book_id=${book_id}&aid=1967&addQueryPrefix=true`) \n    let comments = JSON.parse(res).data.comment\n    let result = `\\n📄 书评：${comments.length>0?(\"(共 \"+ comments.length +\" 条)\"):\"\"}\\n`\n    comments.forEach(c => {\n        let startNum = 5 - parseInt(c.score/2)\n        result += `${c.user_info.gender==1?\"👨🏻\":\"👱🏻\"} ${c.user_info.user_name} || ${\"★★★★★★☆☆☆☆☆\".slice(startNum, startNum + 5)}\\n${c.text}\\n&lrm;\\n`\n    })\n    return result\n    } \n  result = \"\"\n  return result\n}", "lastUpdateTime": 1734413920428, "loginCheckJs": "if (source.getVariable()==\"\") {\n    eval(String(source.loginUrl));\n    reg(true);\n}\nresult", "loginUi": "[\n{\n  name: \"手动登录Token\",\n  type: \"password\",\n  action: \"\"\n},\n{\n  name: \"搜索聚合\",\n  type: \"text\",\n  action: \"\"\n},\n{\n\tname: \"　　[查看教程]　　\",\n\ttype: \"button\",\n\taction: \"tutorial()\"\n},\n{\n\tname: \" 　  [查看Token] 　 \",\n\ttype: \"button\",\n\taction: \"logToken()\"\n},\n{\n\tname: \"　　[账号登录]　　\",\n\ttype: \"button\",\n\taction: \"l2(true)\"\n},\n{\n\tname: \"　　[退出登录]　　\",\n\ttype: \"button\",\n\taction: \"logout()\"\n},\n{\n    \"name\": \"   　[查询模式]　   \",\n    \"type\": \"button\",\n    \"action\": \"get()\"\n  },\n  {\n    \"name\": \"  　 [阅读模式]　   \",\n    \"type\": \"button\",\n    \"action\": \"set(0)\"\n  },\n  {\n    \"name\": \"[多人对话]\",\n    \"type\": \"button\",\n    \"action\": \"set(1)\"\n  },\n  {\n    \"name\": \"[真人发音]\",\n    \"type\": \"button\",\n    \"action\": \"set(2)\"\n  },\n  {\n    \"name\": \"[甜美少女]\",\n    \"type\": \"button\",\n    \"action\": \"set(3)\"\n  },\n  {\n    \"name\": \"[清亮青叔]\",\n    \"type\": \"button\",\n    \"action\": \"set(4)\"\n  },\n  {\n    \"name\": \"[成熟大叔]\",\n    \"type\": \"button\",\n    \"action\": \"set(5)\"\n  },\n  {\n    \"name\": \"[开朗青年]\",\n    \"type\": \"button\",\n    \"action\": \"set(6)\"\n  },\n  {\n    \"name\": \"[温柔淑女]\",\n    \"type\": \"button\",\n    \"action\": \"set(7)\"\n  },\n  {\n    \"name\": \"[风雅青叔]\",\n    \"type\": \"button\",\n    \"action\": \"set(8)\"\n  },\n  {\n    \"name\": \"[清纯少女]\",\n    \"type\": \"button\",\n    \"action\": \"set(9)\"\n  },\n  {\n    \"name\": \"[磁性青叔]\",\n    \"type\": \"button\",\n    \"action\": \"set(10)\"\n  },\n  {\n    \"name\": \"[儒雅大叔]\",\n    \"type\": \"button\",\n    \"action\": \"set(11)\"\n  },\n  {\n    \"name\": \"[优雅御姐]\",\n    \"type\": \"button\",\n    \"action\": \"set(12)\"\n  },\n  {\n    \"name\": \"[斯文青叔]\",\n    \"type\": \"button\",\n    \"action\": \"set(13)\"\n  },\n  {\n    \"name\": \"[知性主播]\",\n    \"type\": \"button\",\n    \"action\": \"set(14)\"\n  },\n  {\n    \"name\": \"[成熟升级]\",\n    \"type\": \"button\",\n    \"action\": \"set(15)\"\n  },\n  {\n    \"name\": \"[多人升级]\",\n    \"type\": \"button\",\n    \"action\": \"set(16)\"\n  },\n  {\n    \"name\": \"[俏皮御姐]\",\n    \"type\": \"button\",\n    \"action\": \"set(17)\"\n  },\n  {\n    \"name\": \"[双音灵动]\",\n    \"type\": \"button\",\n    \"action\": \"set(18)\"\n  },\n{\n\tname: \"  祝你天天开心哇 书源 by: 梓澄qwq(also Naiy)  \",\n\ttype: \"button\",\n\taction: \"t()\"\n}\n]", "loginUrl": "// 登录及登录检查\nfunction login_(openBrowser, checkMode) {\n    // java.removeCookie(\"snssdk.com\")\n    var cookie_ = String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) ? String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) : (source.getLoginInfoMap() ? source.getLoginInfoMap() : {})['手动登录Token']\n    // java.toast(cookie_)\n    if (cookie_ && cookie_ != \"\" && !checkMode) {\n        if (!source.variableComment) {\n            java.toast(\"请不要重复登录，请先退出登录！\")\n        } else {\n            java.toast(\"您为填写token登录，请手动移除token后再次登录\")\n        }\n        return false\n    }\n    if (openBrowser) {\n        try {\n            java.startBrowserAwait(\"https://fanqienovel.com/\", \"登录\")\n        } catch (e) {\n            java.toast(e)\n        }\n    }\n    // java.log(\"snssdk cookie: \" + java.getCookie(\"snssdk.com\") + \"will be reomved\")\n    try {\n        cookie.removeCookie(\"snssdk.com\")\n    } catch (e) {}\n    // java.log(cookie)\n    var cookie_ = \"sessionid=\" + (String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) ? String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) : (source.getLoginInfoMap())['手动登录Token'])\n    let user\n    try {\n      user = JSON.parse(java.ajax(\"https://fanqienovel.com/api/user/info/v2,\" + JSON.stringify({\n        method: \"GET\",\n        headers: {\n          \"Cookie\": cookie_\n        }\n      }))).data.name\n     java.log(JSON.stringify(user))\n     } catch (e) {java.log(e)}\n    if (!cookie_ || cookie_ == \"sessionid=\" || !user) {\n        java.toast(\"未获取到登录凭据，登录失败\")\n        return false\n    }\n    java.toast(\"欢迎 \" + user + \"\\n登录成功！\")\n    return true\n}\n\nfunction login() // 一定程度上加上这个函数能够支持更多的版本\n{}\n\nfunction l2(a, b) {\n  try {\n    login_(a, b)\n  } catch (e) {\n    java.log(e+\"\\n\"+e.stack)\n  }\n}\n\n// 取消登录\nfunction logout() {\n    cookie.removeCookie(\"fanqienovel.com\");\n    cookie.removeCookie(\"snssdk.com\");\n    if (String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) ? String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) : (source.getLoginInfoMap() ? source.getLoginInfoMap() : {})['手动登录Token']) java.toast(\"请手动移除填写的Token\")\n    else java.toast(\"退出登录成功\");\n}\n\nfunction logToken() {\n  java.log(\n    String(\n      cookie.getKey(\n        \"fanqienovel.com\",\n        \"sessionid\"\n      )\n    ) ? String(\n     cookie.getKey(\n        \"fanqienovel.com\", \n        \"sessionid\"\n      )\n    ) : (\n     source.getLoginInfoMap()\n      ? source.getLoginInfoMap()\n      : {}\n    )['手动登录Token']\n  )\n  java.toast(\"登录Token已打印到日志，请妥善保管\")\n}\n\nfunction tutorial() {\n  java.longToast(\"\\n手动登录token功能用于部分用户的跨端登录，不知道是什么的留空就行\\n普通用户请使用下方的\\\"账号登录\\\"按钮登录自己的账号\")\n}\n\nfunction t() {\n  let gc = [\"(*^ω^*)\", \"(=^▽^=)\", \"(。’▽’。)♡\", \"٩(๑´0`๑)۶\", \"喵\", \"你好？\", \"逢考必过！\", \"早ﾉ☀\"]\n  rnd = Math.floor(Math.random() * 100)\n  if (typeof gc[rnd] != \"undefined\") {\n    java.toast(gc[rnd])\n  } else {\n    let res = JSON.parse(\n      java.ajax(\"https://v1.hitokoto.cn\")\n    )\n    java.toast(res.hitokoto)\n  }\n}\n\n// 音色设置，以及链接\nvar data = [\n    [\"阅读模式\", \"\"],\n    [\"多人对话\", \"tone_id=51\"],\n    [\"真人发音\", \"tone_id=0\"],\n    [\"甜美少女\", \"tone_id=1\"],\n    [\"清亮青叔\", \"tone_id=2\"],\n    [\"成熟大叔\", \"tone_id=4\"],\n    [\"开朗青年\", \"tone_id=5\"],\n    [\"温柔淑女\", \"tone_id=6\"],\n    [\"风雅青叔\", \"tone_id=8\"],\n    [\"清纯少女\", \"tone_id=12\"],\n    [\"磁性青叔\", \"tone_id=17\"],\n    [\"儒雅大叔\", \"tone_id=29\"],\n    [\"优雅御姐\", \"tone_id=30\"],\n    [\"斯文青叔\", \"tone_id=31\"],\n    [\"知性主播\", \"tone_id=32\"],\n    [\"成熟升级\", \"tone_id=74\"],\n    [\"多人升级\", \"tone_id=80\"],\n    [\"俏皮御姐\", \"tone_id=100\"],\n    // [\"邻家妹妹\", \"\"],\n    [\"双音灵动\", \"tone_id=103\"]\n];\n\n// 设置保存接口\nfunction set(num) {\n    if (num < 0 || num >= data.length) {\n        java.longToast(\"无效的接口编号！\");\n        return;\n    }\n    var show = \"设置成功\\n当前模式：\";\n    var tips = \"\";\n    var msg = show + data[num][0] + tips;\n    java.longToast(msg);\n    var setData = {\n        sz: num.toString(),\n        tone: data[num][1]\n    };\n    source.setVariable(JSON.stringify(setData));\n}\n\n// 获取接口显示\nfunction get() {\n    var v = source.getVariable();\n    try {\n        var szStr = JSON.parse(v).sz;\n        var sz = parseInt(szStr, 10);\n        if (sz < 0 || sz >= data.length) {\n            sz = 0;\n        }\n        var show = \"当前模式：\";\n        java.longToast(show + data[sz][0]);\n    } catch (e) {\n        java.longToast(\"获取模式失败，使用默认模式。\");\n    }\n}\n\nfunction reg(is) {\n if (is) {\nvar v = source.getVariable();\ntry {\n    var szStr = JSON.parse(v).sz;\n    var sz = parseInt(szStr, 10);\n    if (sz < 0 || sz >= data.length) {\n        sz = 0;\n    }\n    set(sz);\n} catch (e) {\n    //java.longToast(\"初始化模式失败，使用默认模式。\");\n    sz = 0;\n    set(sz);\n    }\n  }\n}", "respondTime": 180000, "ruleBookInfo": {"author": "author", "coverUrl": "@js:java.getString(\"thumb_url\")", "init": "<js>\nvar model = [\n    [\"阅读模式\", \"\"],\n    [\"多人对话\", \"tone_id=51\"],\n    [\"真人发音\", \"tone_id=0\"],\n    [\"甜美少女\", \"tone_id=1\"],\n    [\"清亮青叔\", \"tone_id=2\"],\n    [\"成熟大叔\", \"tone_id=4\"],\n    [\"开朗青年\", \"tone_id=5\"],\n    [\"温柔淑女\", \"tone_id=6\"],\n    [\"风雅青叔\", \"tone_id=8\"],\n    [\"清纯少女\", \"tone_id=12\"],\n    [\"磁性青叔\", \"tone_id=17\"],\n    [\"儒雅大叔\", \"tone_id=29\"],\n    [\"优雅御姐\", \"tone_id=30\"],\n    [\"斯文青叔\", \"tone_id=31\"],\n    [\"知性主播\", \"tone_id=32\"],\n    [\"成熟升级\", \"tone_id=74\"],\n    [\"多人升级\", \"tone_id=80\"],\n    [\"俏皮御姐\", \"tone_id=100\"],\n    // [\"邻家妹妹\", \"\"],\n    [\"双音灵动\", \"tone_id=103\"]\n];\nfunction get(index) {\n  if (index == '4') {\n    java.longToast(\"当前模式：番茄畅听\\n本书支持真人发音\")\n  } else { \n  var v = source.getVariable();\n    try {\n        var szStr = JSON.parse(v).sz;\n        var sz = parseInt(szStr, 10);\n        if (sz < 0 || sz >= model.length) {\n            sz = 0;\n        }\n        var show = \"当前模式：\";\n        java.longToast(show + model[sz][0]);\n    } catch (e) {\n        java.longToast(\"获取模式失败，使用默认模式。\");\n    }\n  }\n}\nfunction getTones(tones, run) {\n    if (run == 0) {\n    var voiceTones = tones.split(',').map(function(tone) {\n        var voice = model.find(function(item) {\n            return item[1] == `tone_id=${tone}`;\n        });\n        return voice ? voice[0] : '';\n    });\n    return '🎼 音色支持：' + voiceTones + '\\n';\n    } \n  return ''\n}\n\nvar Res  = JSON.parse(result);\nvar data = Res.page || Res.data;\ndata = (Array.isArray(data) ? data[0] : data.book_info) || data;\nvar type = data.genre;\njava.put(\"type\",type);\nget(type);\nvar tts_info = getTones(data.tones, data.genre);\njava.put(\"tts_info\", tts_info);\nJSON.stringify(data);\n</js>", "intro": "&nbsp;&nbsp;\n📕 源名：{{$.original_book_name}}\n📖 别名：{{$.book_flight_alias_name}}\n✏️ 开坑：{{$.create_time##T|\\+.*## }}\n🏷️ 标签：{{$.tags}}\n👤 主角：{{$.roles##\\[|\\\"|\\]}}\n👁️ 在线：{{$.read_count}}人在读{{\"\\n\"+\"​\"}}\n📜 简介：{{$.abstract}}{{\"\\n\"+\"​\"}}\n📍 {{$.copyright_info##，.*##。}}{{\"\\n\"+\"​\"}}\n{{java.get('tts_info')}}\n{{getNovelComment(java.getString(\"$.book_id\"),java.get(\"type\"))}} \n@js:result.replace(/.+：(人在读)?\\n/g,\"\")", "kind": "男生{{$.gender}}女生\n{{$.category}}\n连载{{$.creation_status}}完结\n{{$.score}}分\n{{java.timeFormatUTC(java.getString(\"last_chapter_update_time\")*1000,'yyyy-MM-dd',8)}} \n##连载0|1完结|男生0|1女生\n@js:result\n.replace(\"男生2女生\",\"出版\")\n.replace(\"连载4完结\",\"断更\")\n.replace(\"连载-1完结\",\"未知\");", "lastChapter": "{{$.last_chapter_title}} • {{java.timeFormat(java.getString(\"last_chapter_update_time\")*1000)}}", "name": "book_name", "tocUrl": "$.book_id\n@js:\njava.put('book_id', result);\nsource.bookSourceUrl + '/catalog?book_id=' + result;", "wordCount": "word_number"}, "ruleContent": {"content": "<js>\nvar item_id = java.hexDecodeToString(result);\nvar book_id = java.get('book_id');\nvar type = String(java.get('type'));\nvar v = JSON.parse(source.getVariable());\nvar sz = v.sz;\nvar tone = v.tone;\n\nif (type == 1) {\n  book.type = 64;\n} else if (type == 4 || sz != 0) {\n  book.type = 32;\n} else {\n  book.type = 8;\n}\n\nif (type == 4 || sz != 0) {\n    if (type == 4) {\n    url = source.bookSourceUrl + `/audio?tone_id=1&item_ids=${item_id}`; \n} else if (sz != 0) {\n    url = source.bookSourceUrl + `/audio?${tone}&item_ids=${item_id}`; \n}\n  try {\n    result = JSON.parse(java.ajax(url)).data[0]['main_url']; \n  } catch(e) { result = \"该书不支持当前音色，请更换并刷新\"; }\n} else {\nlet url = source.bookSourceUrl + '/content?item_id=' + item_id;\nlet res = JSON.parse(java.ajax(url)).data.content;\nfunction getComic(result) {\n  let mat = result.match(/<article>([\\s\\S]*?)<\\/article>/); \n  try {\n    let cnt = JSON.parse(\n      mat\n        ? mat[1].replace(/\\&/g, '\"').replace(/\\;/g, \"\").replace(/\\#34/g, \"\")\n        : result\n    );\n    return (mat ? cnt.skeleton.data : cnt.picInfos)\n      .map((i) => {\n        let path = mat\n          ? cnt.materials[i.element_name].data.web_uri\n          : \"novel-pic/\" + i.md5;\n        return `<img src=\"https://p3-novel.byteimg.com/origin/${path}\">`;\n      })\n      .join(\"<br>\");\n  } catch (e) { // not comic content\n    mat = result.match(/<body>([\\s\\S]*?)<\\/body>/) \n    // java.log(result)\n    return (mat ? mat[1] : result).toString().replace(/\\<\\!DOCTYPE html.*/g, \"\").replace(/\\<tt_keyword_ad.*\\<\\/tt_keyword_ad\\>/, \"\").replace(/\\<a epub.*\\>\\<\\/a\\>/g, \"\")\n     }\n  }\nresult = getComic(String(res));\n}\nresult.replace(/\\{\\!\\-\\- PGC_VOICE\\:.*\\-\\-\\}/g, \"\")\n</js>@@p@html||html"}, "ruleExplore": {"author": "$.author", "bookList": "<js>\nfunction getBookIdFull(url) {\n\tconst {java} = this\n\t$ = JSON.parse(url).data\n\tif ($.book_shelf_info != 0 && $.book_shelf_info != undefined) {\n\t\tarr = $.book_shelf_info.map($ => $.book_id)\n\t} else if (list = $.data_list != 0 && $.data_list != undefined)  {\n\t\tarr = $.data_list.map($ => $.book_id_str)\n\t} else {\n\t\tjava.toast(\"获取 book_id 失败，你可能需要登录！\")\n\t}\n\treturn arr\n}\nlet ck = \"sessionid=\" + (String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) ? String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) : (source.getLoginInfoMap() ? source.getLoginInfoMap() : {})['手动登录Token'])\n\ngetShelf = () => {\nlet book_shelf_url = 'https://fanqienovel.com/reading/bookapi/bookshelf/info/v:version/?aid=1967&iid=0&version_code=57700&update_version_code=57700'\nlet book_shelf_info = java.ajax(book_shelf_url + ', ' + JSON.stringify({\n  headers: {\n    'Cookie': ck\n  }\n}))\n\nbid = getBookIdFull(book_shelf_info)\nlet id_list = splitArray(bid, 100)\nlet urls = []\nid_list.forEach(i => {\n    urls.push(source.bookSourceUrl + \"/multi-detail?book_id=\" + i.join(\",\"))\n})\n\nres = java.ajaxAll(urls)\n\nlet resp = {book_info: []}\nres.forEach(r => {\n  resp.book_info = resp.book_info.concat(JSON.parse(r.body()).data)\n})\n\nreturn resp\n}\n\nfunction getByGroupName(name) {\n  let book_shelf_url = 'https://fanqienovel.com/reading/bookapi/bookshelf/info/v:version/?aid=1967&iid=0&version_code=57700&update_version_code=57700'\n\n  let book_shelf_info = JSON.parse(java.ajax(book_shelf_url + ', ' + JSON.stringify({\n    headers: {\n      'Cookie': ck,\n    }\n  })))\n  let group_bookids = {\n    \"未分组\": []\n  }\n  // java.log(\n  book_shelf_info.data.book_shelf_info.forEach(i => {\n    if (!group_bookids[i.group_name ? i.group_name : \"未分组\"]) group_bookids[i.group_name] = []\n    group_bookids[i.group_name ? i.group_name : \"未分组\"].push(i.book_id)\n  })\n  // java.log(JSON.stringify(group_bookids[\"未分组\"]))\n  // java.log(decodeURIComponent(name))\n  if (!group_bookids[decodeURIComponent(name)]) return {data: []}\n  //java.log(\"awa\")\n  let book_ids = splitArray(group_bookids[decodeURIComponent(name)], 100)\n  let urls = []\n\n  book_ids.forEach(i => {\n    urls.push(source.bookSourceUrl + \"/multi-detail?book_id=\" + i.join(\",\"))\n  })\n  java.log(urls)\n  res = java.ajaxAll(urls)\n\n  let resp = {book_info: []}\n  res.forEach(r => {\n    resp.book_info = resp.book_info.concat(JSON.parse(r.body()).data)\n  })\n\n  return resp\n}\n\nfunction getByTabIndex(index) {\n  let url = _mlsec.requestHeader(\n\t  \"bookmall/tab\",\n    \"version_name=5.8.9.32\",\n\t  null,\n\t  ck\n  )\n  let all = JSON.parse(java.ajax(url))\n  let tab = all.data.tab_item[0].cell_data[index].cell_data\n  if (!tab) tab = []\n  let bookList = []\n  for (let i of tab) {\n    bookList = bookList.concat(i.book_data)\n    // java.log(JSON.stringify(i.book_data))\n  }\n  return { book_info: bookList }\n}\n\nif (baseUrl.endsWith(\"bookshelf\")) result = getShelf(\"bookshelf/info\")\nelse if(/read_history/.test(baseUrl)) {\n  bid = getBookIdFull(result);\n  id_list = splitArray(bid, 100);\n  let urls = [];\n  id_list.forEach(i => {\nurls.push(source.bookSourceUrl + \"/multi-detail?book_id=\" + i.join(\",\"))\n});\n  let resp = {book_info: []}\n  urls.forEach(r => {\n    resp.book_info = resp.book_info.concat(JSON.parse(java.ajax(r)).data)\n  })\n  result = resp;\n} else {\n  let w = baseUrl.split(\"/\")\n  if (baseUrl.includes(\"groupName\")) {\n    result = getByGroupName(w[w.length - 1])\n  } else if (baseUrl.includes(\"tab\")) {\n    result = getByTabIndex(parseInt(w[w.length - 1]))\n  } else result = JSON.parse(result)\n}\nJSON.stringify({data: result.book_info || result.data.book_info || result.detail_list || result.data})\n</js>\n$.data[*]", "bookUrl": "{{source.bookSourceUrl}}/detail?book_id={{$.book_id}}", "coverUrl": "@js:java.getString(\"thumb_url\")", "intro": "$.abstract##\\n", "kind": "男生{{$.gender}}女生\n连载{{$.creation_status}}完结\n{{$.score}}分\n{{$..text}}\n{{$.sub_info}}\n##连载0|1完结|男生0|1女生|男生女生[\\s\\S]*\n@js:result\n.replace(\"男生2女生\",\"出版\")\n.replace(\"连载4完结\",\"断更\")\n.replace(\"连载-1完结\",\"未知\");", "lastChapter": "", "name": "$.book_name", "wordCount": "$.word_number"}, "ruleSearch": {"author": "author", "bookList": "<js>\nlet book_ids = [];\nlet book_list = [];\nlet res = JSON.parse(result);\nlet i = String(java.get(\"i\"));\nlet key = String(java.get(\"key\"));\nlet page = Number(java.get(\"page\"));\n\ntry {\n  list = res[\"search_tabs\"][i][\"data\"];\n  if(list == null) list = res[\"search_tabs\"][1][\"data\"];\n  // java.log(JSON.stringify(list))\n  for (let $ of list) {\n            if (!book_ids.includes($.book_id)) {\n                book_list.push($.book_data ? $.book_data[0] : $);\n                book_ids.push($.book_id);\n            }\n        }\n    } catch (e) {}\n    \nso = source.getLoginInfoMap()['搜索聚合'] || \"0\";\nif (so == \"1\" || book_list.length == 0) {\njava.toast(\"当前为搜索聚合模式\")\nlet url = `https://api5-normal-lf.fqnovel.com/reading/bookapi/search/page/v/?query=${key}&aid=1967&channel=0&os_version=0&device_type=0&device_platform=0&iid=466614321180296&passback=${(page-1)*10}&version_code=999`; \n    let list = JSON.parse(java.ajax(url)).data;\n    // java.log(JSON.stringify(list))\n    for (let $ of list) {\n            if (!book_ids.includes($.book_id)) {\n                book_list.push($.book_data ? $.book_data[0] : $);\n                book_ids.push($.book_id);\n            }\n        }\n    };\n    \nJSON.stringify(book_list)\n</js>$[*]", "bookUrl": "{{source.bookSourceUrl}}/detail?book_id={{$.book_id}}", "checkKeyWord": "转生三无猫娘，成神的我只想摸鱼", "coverUrl": "@js:java.getString(\"thumb_url\")", "intro": "abstract##\\n", "kind": "男生{{$.gender}}女生\n连载{{$.creation_status}}完结\n{{$.score}}分\n{{$..text}}\n{{$.sub_info}}\n##连载0|1完结|男生0|1女生|男生女生[\\s\\S]*\n@js:result\n.replace(\"男生2女生\",\"出版\")\n.replace(\"连载4完结\",\"断更\")\n.replace(\"连载-1完结\",\"未知\");", "name": "book_name", "wordCount": "word_number"}, "ruleToc": {"chapterList": "<js>\nvar type = java.get('type');\nvar v = JSON.parse(source.getVariable());\nvar sz = v.sz;\nif (type == 1) {\n  book.type = 64;\n} else if (type == 4 || sz != 0) {\n  book.type = 32;\n} else {\n  book.type = 8;\n}\nresult\n</js>data.item_data_list[*]", "chapterName": "title", "chapterUrl": "$.item_id\n<js>java.base64Encode(result)</js>\ndata:;base64,{{result}},{\"type\":\"fqpyc\"}", "isPay": "", "isVip": "", "updateTime": "{{$.volume_name}} | {{$.chapter_word_number}}字 | {{java.timeFormatUTC(java.getString(\"first_pass_time\") * 1000, 'yyyy-MM-dd HH:mm:ss', 12)}}##第一卷：默认\n@js:\nif (result.startsWith(\" |\")) result = result.slice(2)\nif (result.startsWith(\"| \")) result = result.slice(2)\nresult"}, "searchUrl": "@js:\ntab = 3\nif(tab == 3) java.put(\"i\", \"5\")\nif (String(key).startsWith(\"m:\")||String(key).startsWith(\"m：\")) {\n  tab = 8\n  key = key.slice(2)\n  java.put(\"i\", \"3\")\n}\nif (String(key).startsWith(\"t:\")||String(key).startsWith(\"t：\")) {\n  tab = 2\n  key = key.slice(2)\n  java.put(\"i\", \"4\")\n}\n\nsource.bookSourceUrl + '/search?query=' + encodeURI(java.put(\"key\", key)) + '&offset=' + ((java.put(\"page\", page) - 1) * 10) + '&tab_type=' + tab", "weight": 0}]
